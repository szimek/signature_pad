/*!
 * Signature Pad v1.3.4 | https://github.com/szimek/signature_pad
 * (c) 2015 Szymon Nowak | Released under the MIT license
 */
var SignaturePad=function(a){"use strict";var b=function(a){1===a.which&&(this._mouseButtonDown=!0,this._strokeBegin(a))},c=function(a){this._mouseButtonDown&&this._strokeUpdate(a)},d=function(a){1===a.which&&this._mouseButtonDown&&(this._mouseButtonDown=!1,this._strokeEnd(a))},e=function(a){var b=a.changedTouches[0];this._strokeBegin(b)},f=function(a){a.preventDefault();var b=a.changedTouches[0];this._strokeUpdate(b)},g=function(a){var b=a.target===this._canvas;b&&this._strokeEnd(a)},h=function(a,h){var i=h||{};this.velocityFilterWeight=i.velocityFilterWeight||.7,this.minWidth=i.minWidth||.5,this.maxWidth=i.maxWidth||2.5,this.dotSize=i.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=i.penColor||"black",this.backgroundColor=i.backgroundColor||"rgba(0,0,0,0)",this.onEnd=i.onEnd,this.onBegin=i.onBegin,this.enableTypeToSign=i.enableTypeToSign||!1,this.inputSelector=i.inputSelector,this.maxFontSize=i.maxFontSize||300,this.fontface=i.fontface||"Helvetica",this._canvas=a,this._ctx=a.getContext("2d"),this._mouseDownHandler=b.bind(this),this._mouseMoveHandler=c.bind(this),this._mouseUpHandler=d.bind(this),this._touchStartHandler=e.bind(this),this._touchMoveHandler=f.bind(this),this._touchEndHandler=g.bind(this),this.clear(),this._handleMouseEvents(),this._handleTouchEvents(),this._handleTypeEvents()};h.prototype.clear=function(){var a=this._ctx,b=this._canvas;a.fillStyle=this.backgroundColor,a.clearRect(0,0,b.width,b.height),a.fillRect(0,0,b.width,b.height),this._reset()},h.prototype.toDataURL=function(){var a=this._canvas;return a.toDataURL.apply(a,arguments)},h.prototype.fromDataURL=function(a){var b=this,c=new Image,d=window.devicePixelRatio||1,e=this._canvas.width/d,f=this._canvas.height/d;this._reset(),c.src=a,c.onload=function(){b._ctx.drawImage(c,0,0,e,f)},this._isEmpty=!1},h.prototype._strokeUpdate=function(a){var b=this._createPoint(a);this._addPoint(b)},h.prototype._strokeBegin=function(a){this._reset(),this._strokeUpdate(a),"function"==typeof this.onBegin&&this.onBegin(a)},h.prototype._strokeDraw=function(a){var b=this._ctx,c="function"==typeof this.dotSize?this.dotSize():this.dotSize;b.beginPath(),this._drawPoint(a.x,a.y,c),b.closePath(),b.fill()},h.prototype._strokeEnd=function(a){var b=this.points.length>2,c=this.points[0];!b&&c&&this._strokeDraw(c),"function"==typeof this.onEnd&&this.onEnd(a)},h.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._mouseDownHandler),this._canvas.addEventListener("mousemove",this._mouseMoveHandler),a.addEventListener("mouseup",this._mouseUpHandler)},h.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.addEventListener("touchstart",this._touchStartHandler),this._canvas.addEventListener("touchmove",this._touchMoveHandler),a.addEventListener("touchend",this._touchEndHandler)},h.prototype._handleTypeEvents=function(){var b=this,c=b._canvas.height/2,d=a.querySelector(b.inputSelector);b.enableTypeToSign&&d.addEventListener("keyup",function(){b._ctx.clearRect(0,0,b._canvas.width,b._canvas.height),b._ctx.textBaseline="middle",b._ctx.textAlign="center",b._fitTextOnCanvas(d.value,b.fontface,b.fontsize,c)})},h.prototype.disableDrawing=function(){this._canvas.removeEventListener("mousedown",this._mouseDownHandler),this._canvas.removeEventListener("mousemove",this._mouseMoveHandler),a.removeEventListener("mouseup",this._mouseUpHandler),this._canvas.removeEventListener("touchstart",this._touchStartHandler),this._canvas.removeEventListener("touchmove",this._touchMoveHandler),a.removeEventListener("touchend",this._touchEndHandler)},h.prototype.enableDrawing=function(){this._handleMouseEvents(),this._handleTouchEvents()},h.prototype._fitTextOnCanvas=function(a,b,c,d){var e=this.maxFontSize,f=window.devicePixelRatio||1;do e--,this._ctx.font=e+"pt "+b;while(this._ctx.measureText(a).width>this._canvas.width/f);this._ctx.fillText(a,this._canvas.width/f/2,d)},h.prototype.isEmpty=function(){return this._isEmpty},h.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._isEmpty=!0,this._ctx.fillStyle=this.penColor},h.prototype._createPoint=function(a){var b=this._canvas.getBoundingClientRect();return new i(a.clientX-b.left,a.clientY-b.top)},h.prototype._addPoint=function(a){var b,c,d,e,f=this.points;f.push(a),f.length>2&&(3===f.length&&f.unshift(f[0]),e=this._calculateCurveControlPoints(f[0],f[1],f[2]),b=e.c2,e=this._calculateCurveControlPoints(f[1],f[2],f[3]),c=e.c1,d=new j(f[1],b,c,f[2]),this._addCurve(d),f.shift())},h.prototype._calculateCurveControlPoints=function(a,b,c){var d=a.x-b.x,e=a.y-b.y,f=b.x-c.x,g=b.y-c.y,h={x:(a.x+b.x)/2,y:(a.y+b.y)/2},j={x:(b.x+c.x)/2,y:(b.y+c.y)/2},k=Math.sqrt(d*d+e*e),l=Math.sqrt(f*f+g*g),m=h.x-j.x,n=h.y-j.y,o=l/(k+l),p={x:j.x+m*o,y:j.y+n*o},q=b.x-p.x,r=b.y-p.y;return{c1:new i(h.x+q,h.y+r),c2:new i(j.x+q,j.y+r)}},h.prototype._addCurve=function(a){var b,c,d=a.startPoint,e=a.endPoint;b=e.velocityFrom(d),b=this.velocityFilterWeight*b+(1-this.velocityFilterWeight)*this._lastVelocity,c=this._strokeWidth(b),this._drawCurve(a,this._lastWidth,c),this._lastVelocity=b,this._lastWidth=c},h.prototype._drawPoint=function(a,b,c){var d=this._ctx;d.moveTo(a,b),d.arc(a,b,c,0,2*Math.PI,!1),this._isEmpty=!1},h.prototype._drawCurve=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=this._ctx,p=c-b;for(d=Math.floor(a.length()),o.beginPath(),f=0;d>f;f++)g=f/d,h=g*g,i=h*g,j=1-g,k=j*j,l=k*j,m=l*a.startPoint.x,m+=3*k*g*a.control1.x,m+=3*j*h*a.control2.x,m+=i*a.endPoint.x,n=l*a.startPoint.y,n+=3*k*g*a.control1.y,n+=3*j*h*a.control2.y,n+=i*a.endPoint.y,e=b+i*p,this._drawPoint(m,n,e);o.closePath(),o.fill()},h.prototype._strokeWidth=function(a){return Math.max(this.maxWidth/(a+1),this.minWidth)};var i=function(a,b,c){this.x=a,this.y=b,this.time=c||(new Date).getTime()};i.prototype.velocityFrom=function(a){return this.time!==a.time?this.distanceTo(a)/(this.time-a.time):1},i.prototype.distanceTo=function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))};var j=function(a,b,c,d){this.startPoint=a,this.control1=b,this.control2=c,this.endPoint=d};return j.prototype.length=function(){var a,b,c,d,e,f,g,h,i=10,j=0;for(a=0;i>=a;a++)b=a/i,c=this._point(b,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),d=this._point(b,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y),a>0&&(g=c-e,h=d-f,j+=Math.sqrt(g*g+h*h)),e=c,f=d;return j},j.prototype._point=function(a,b,c,d,e){return b*(1-a)*(1-a)*(1-a)+3*c*(1-a)*(1-a)*a+3*d*(1-a)*a*a+e*a*a*a},h}(document);