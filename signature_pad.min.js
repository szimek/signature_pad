/*!
 * Signature Pad v1.1.0 | https://github.com/szimek/signature_pad
 * (c) 2013 Szymon Nowak | Released under the MIT license
 */
var SignaturePad=function(a){"use strict";function b(a,b){this.type=b,this.point=a}var c=function(b,c){var d=this,e=c||{};this.opts={velocityFilterWeight:.7,minWidth:.5,maxWidth:2.5,color:"black",dotSize:function(){return(this.opts.minWidth+this.opts.maxWidth)/2},record:!0},this.config(e),this._canvas=b,this._ctx=b.getContext("2d"),this._resetRecords(),this._reset(),this._mouseButtonDown=!1,b.addEventListener("mousedown",function(a){1===a.which&&(d._mouseButtonDown=!0,d._strokeStart(a))}),b.addEventListener("mousemove",function(a){d._mouseButtonDown&&d._strokeFromEvent(a)}),a.addEventListener("mouseup",function(a){1===a.which&&d._mouseButtonDown&&(d._mouseButtonDown=!1),d._strokeEnd()}),b.addEventListener("touchstart",function(a){var b=a.changedTouches[0];d._strokeStart(b)}),b.addEventListener("touchmove",function(a){a.preventDefault();var b=a.changedTouches[0];d._strokeFromEvent(b)}),a.addEventListener("touchend",function(a){var b=a.target===d._canvas;b&&d._strokeEnd()})};c.prototype.config=function(a){for(var b in this.opts)b in a&&(this.opts[b]=a[b])},c.prototype._resetRecords=function(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this.records=[],this._recording=!1},c.prototype.clear=function(){this._replaying&&(this._replaying=!1),this._resetRecords(),this._reset()},c.prototype.replay=function(){function a(){if(b._replaying){var e,f=b.records[c];return b._replayStep(f),c+=1,c===d?(b._replaying=!1,void 0):(e=b.records[c],window.setTimeout(a,e.point.time-f.point.time),void 0)}}var b=this,c=0,d=this.records.length;b._replaying=!0,b._recording=!1,this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),d>0&&a()},c.prototype.toDataURL=function(){return this._canvas.toDataURL(arguments)},c.prototype.fromDataURL=function(a){var b=new Image;b.src=a,this._ctx.drawImage(b,0,0,this._canvas.width,this._canvas.height)},c.prototype.isEmpty=function(){return this._isEmpty},c.prototype._reset=function(){this._recordStep(new b(new d,"reset")),this.points=[],this._lastVelocity=0,this._lastWidth=(this.opts.minWidth+this.opts.maxWidth)/2,this._isEmpty=!0,this._ctx.fillStyle=this.opts.color},c.prototype._recordStep=function(a){this.opts.record&&!this._replaying&&this._recording&&this.records.push(a)},c.prototype._createPoint=function(a){var b=this._canvas.getBoundingClientRect();return new d(a.clientX-b.left,a.clientY-b.top)},c.prototype._addPoint=function(a){var c,d,f,g,h=this.points;this._recordStep(new b(a)),h.push(a),h.length>2&&(3===h.length&&h.unshift(h[0]),g=this._calculateCurveControlPoints(h[0],h[1],h[2]),c=g.c2,g=this._calculateCurveControlPoints(h[1],h[2],h[3]),d=g.c1,f=new e(h[1],c,d,h[2]),this._addCurve(f),h.shift())},c.prototype._addDot=function(a){var c=this._ctx,d="function"==typeof this.opts.dotSize?this.opts.dotSize.call(this):this.opts.dotSize;this._recordStep(new b(a,"dot")),c.beginPath(),this._drawPoint(a.x,a.y,d),c.closePath(),c.fill()},c.prototype._replayStep=function(a){"dot"===a.type?this._addDot(a.point):"reset"===a.type?this._reset():this._addPoint(a.point)},c.prototype._strokeStart=function(a){this.opts.record&&!this._recording&&(this._resetRecords(),this._recording=!0),this._reset(),this._strokeFromEvent(a)},c.prototype._strokeFromEvent=function(a){var b=this._createPoint(a);this._addPoint(b)},c.prototype._strokeEnd=function(){var a=this.points.length>2,b=this.points[0];!a&&b&&this._addDot(b)},c.prototype._calculateCurveControlPoints=function(a,b,c){var e=a.x-b.x,f=a.y-b.y,g=b.x-c.x,h=b.y-c.y,i={x:(a.x+b.x)/2,y:(a.y+b.y)/2},j={x:(b.x+c.x)/2,y:(b.y+c.y)/2},k=Math.sqrt(e*e+f*f),l=Math.sqrt(g*g+h*h),m=i.x-j.x,n=i.y-j.y,o=l/(k+l),p={x:j.x+m*o,y:j.y+n*o},q=b.x-p.x,r=b.y-p.y;return{c1:new d(i.x+q,i.y+r),c2:new d(j.x+q,j.y+r)}},c.prototype._addCurve=function(a){var b,c,d=a.startPoint,e=a.endPoint;b=e.velocityFrom(d),b=this.opts.velocityFilterWeight*b+(1-this.opts.velocityFilterWeight)*this._lastVelocity,c=this._strokeWidth(b),this._drawCurve(a,this._lastWidth,c),this._lastVelocity=b,this._lastWidth=c},c.prototype._drawPoint=function(a,b,c){var d=this._ctx;d.moveTo(a,b),d.arc(a,b,c,0,2*Math.PI,!1),this._isEmpty=!1},c.prototype._drawCurve=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=this._ctx,p=c-b;for(d=Math.floor(a.length()),o.beginPath(),f=0;d>f;f++)g=f/d,h=g*g,i=h*g,j=1-g,k=j*j,l=k*j,m=l*a.startPoint.x,m+=3*k*g*a.control1.x,m+=3*j*h*a.control2.x,m+=i*a.endPoint.x,n=l*a.startPoint.y,n+=3*k*g*a.control1.y,n+=3*j*h*a.control2.y,n+=i*a.endPoint.y,e=b+i*p,this._drawPoint(m,n,e);o.closePath(),o.fill()},c.prototype._strokeWidth=function(a){return Math.max(this.opts.maxWidth/(a+1),this.opts.minWidth)};var d=function(a,b,c){this.x=a,this.y=b,this.time=c||(new Date).getTime()};d.prototype.velocityFrom=function(a){return this.distanceTo(a)/(this.time-a.time)},d.prototype.distanceTo=function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))};var e=function(a,b,c,d){this.startPoint=a,this.control1=b,this.control2=c,this.endPoint=d};return e.prototype.length=function(){var a,b,c,d,e,f,g,h,i=10,j=0;for(a=0;i>=a;a++)b=a/i,c=this._point(b,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),d=this._point(b,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y),a>0&&(g=c-e,h=d-f,j+=Math.sqrt(g*g+h*h)),e=c,f=d;return j},e.prototype._point=function(a,b,c,d,e){return b*(1-a)*(1-a)*(1-a)+3*c*(1-a)*(1-a)*a+3*d*(1-a)*a*a+e*a*a*a},c}(document);